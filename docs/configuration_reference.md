# Configuration Reference

This document is the single source of truth for runtime configuration in SISC.

## 1. FrameworkConfig Fields

All fields below are part of `FrameworkConfig` and can be provided to `runFullSimulation({ config })`.

### Episode Limits

| Field                     |    Type |   Default | Description                                     |
| ------------------------- | ------: | --------: | ----------------------------------------------- |
| `max_turns_per_episode` | `int` |    `20` | Hard cap on turns before timeout.               |
| `max_episode_tokens`    | `int` | `50000` | Cost circuit breaker per episode.               |
| `max_concurrency`       | `int` |     `5` | Parallel episode limit in epochs/shadow trials. |

### Mutation Settings

| Field                            |                Type |  Default | Description                                |
| -------------------------------- | ------------------: | -------: | ------------------------------------------ |
| `epoch_size`                   |             `int` |   `10` | Episodes per generation.                   |
| `mutation_variants`            |             `int` |    `3` | Candidate strategies generated by mutator. |
| `shadow_trial_count`           |             `int` |   `10` | Trials per mutation/creation shadow test.  |
| `improvement_margin`           |          `number` |  `0.5` | Required lift over baseline.               |
| `acceptance_lcb_lambda`        |      `number > 0` |    `1` | Variance penalty multiplier in LCB gating. |
| `acceptance_p_value_threshold` | `0 < number <= 1` | `0.05` | Mann-Whitney significance threshold.       |

### Creation Settings

| Field                                   |        Type |  Default | Description                                        |
| --------------------------------------- | ----------: | -------: | -------------------------------------------------- |
| `creation_patience`                   |     `int` |    `5` | Plateau generations before Provisioner activation. |
| `max_active_created_agents`           |     `int` |    `3` | Max concurrently mounted created agents.           |
| `creation_cooldown_generations`       |     `int` |    `3` | Cooldown between creation attempts.                |
| `require_human_approval_for_creation` | `boolean` | `true` | Require manual approval before mount.              |
| `max_generations`                     | `int > 0` |  `100` | Default generation loop cap in orchestrator.       |

### Error Handling

| Field                           |    Type | Default | Description                                      |
| ------------------------------- | ------: | ------: | ------------------------------------------------ |
| `max_validation_retries`      | `int` |   `3` | Retries for invalid agent output before penalty. |
| `forced_concession_threshold` | `int` |   `2` | Penalties before episode corruption.             |

### Explorer / Disruptor / Context

| Field                                |        Type |  Default | Description                                 |
| ------------------------------------ | ----------: | -------: | ------------------------------------------- |
| `scout_sweep_interval_generations` |     `int` |    `5` | Explorer scan interval.                     |
| `scout_on_new_ingredient`          | `boolean` | `true` | Trigger scan when ingredient graph changes. |
| `info_disruptor_frequency`         |     `int` |    `3` | Info disruptor cadence in turns.            |
| `summarization_frequency`          |     `int` |    `5` | Context summarization cadence in turns.     |

## 2. CLI Options

## `sisc init`

| Option        | Type | Description               |
| ------------- | ---- | ------------------------- |
| `-y, --yes` | flag | Skip confirmation prompt. |

## `sisc run`

No command-specific overrides. Uses local `index.js` and whatever config your script passes to `runFullSimulation`.

## `sisc simulate`

| Option                         | Type   | Description                                                    |
| ------------------------------ | ------ | -------------------------------------------------------------- |
| `-s, --scenario <path>`      | string | Path to scenario JSON file.                                    |
| `--provider <provider>`      | string | LLM provider override (`openai`, `google`, `anthropic`). |
| `--model <model>`            | string | LLM model override.                                            |
| `--max-generations <number>` | number | Override generation limit for this run.                        |
| `-y, --yes`                  | flag   | Skip start confirmation prompt.                                |

## 3. Scenario JSON Shape

Minimal shape:

```json
{
  "name": "Example",
  "description": "Example simulation",
  "context": "Initial context",
  "initialState": {
    "variables": { "global_tension_level": 5 }
  },
  "actors": [
    {
      "id": "agent_a",
      "name": "Agent A",
      "role": "Primary actor",
      "personality": "Strategic",
      "immutableCore": "You are Agent A..."
    },
    {
      "id": "agent_b",
      "name": "Agent B",
      "role": "Primary actor",
      "personality": "Defensive",
      "immutableCore": "You are Agent B..."
    }
  ],
  "config": {
    "max_turns_per_episode": 8,
    "epoch_size": 4,
    "max_generations": 12
  },
  "runtime": {
    "provider": "openai",
    "model": "gpt-5-nano"
  },
  "prompts": {
    "judge_system_prompt": "You are an impartial evaluator...",
    "judge_rubric": "Score progress, stability, and strategic consistency."
  }
}
```

Notes:

- `actors` must contain at least two entries.
- Actor `id` values must be unique.
- Missing config keys are filled from `FrameworkConfig` defaults.

## 4. Override Precedence

## Provider / Model resolution (`sisc simulate`)

Provider precedence:

1. CLI `--provider`
2. `scenario.runtime.provider`
3. env `SISC_PROVIDER`
4. built-in default: `openai`

Model precedence:

1. CLI `--model`
2. `scenario.runtime.model`
3. env `SISC_MODEL`
4. provider fallback defaults in resolver

## Generation cap resolution (`sisc simulate`)

1. CLI `--max-generations`
2. `scenario.config.max_generations`
3. `FrameworkConfig` default (`100`)

## API key requirement

Any simulation requiring LLM calls needs at least one set:

- `OPENAI_API_KEY`
- `GOOGLE_GENERATIVE_AI_API_KEY`
- `ANTHROPIC_API_KEY`

## 5. Copy/Paste Examples

## Library usage (`index.js`)

```js
import { runFullSimulation, FrameworkConfig } from "sisc";

const config = FrameworkConfig.parse({
  max_turns_per_episode: 12,
  epoch_size: 6,
  shadow_trial_count: 8,
  improvement_margin: 0.2,
  acceptance_lcb_lambda: 1,
  acceptance_p_value_threshold: 0.05,
  max_generations: 20
});

await runFullSimulation({
  config,
  initialState,
  agents,
  judge,
  mutator,
  provisioner,
  llmClient
});
```

## CLI usage

```bash
# Run with scenario defaults
sisc simulate --scenario scenarios/us-iran-tensions.json

# Override provider/model/generation cap for one run
sisc simulate --scenario scenarios/us-iran-tensions.json \
  --provider openai \
  --model gpt-5-nano \
  --max-generations 5 \
  --yes
```
